第23章 离线应用与客户端存储

本章内容
・进行离线检测
・使用离线缓存
・在浏览器中保存数据

支持离线Web应用开发是HTML5的一个重点。所谓离线Web应用，就是在设备不能上网的情况下仍然可以运行的应用。
开发离线Web应用需要几个步骤。首先是确保应用知道设备是否能上网，以便下一步执行正确的操作。然后，应用还必须能访问一定的资源(图像、
JavaScript、css等)，只有这样才能正常工作。最后，必须有一块本地空间用于保存数据，无论能否上网都不妨碍读写。

23.1 离线检测
开发离线应用的第一步是要知道设备是在线还是离线。HTML5为此定义了一个navigator.onLine属性，这个属性值为true表示设备能上网，值为false
表示设备离线。这个属性的关键是浏览器必须知道设备能否访问网络，从而返回正确的值。实际应用中，navigator.onLine在不同浏览器间还有些小
的差异。
・IE 6+和Safari 5+能够正确检测到网络已断开，并将navigator.onLine的值转换为false
・FireFox 3+和Opera 10.6+支持navigator.onLine属性，但你必须手工选中菜单项“文件→Web开发人员(设置)→脱机工作”才能让浏览器正常工作
・Chrome 11及之前版本始终将navigator.onLine属性设置为true
除了navigator.onLine属性之外，为了更好地确定网络是否可用，HTML5还定义了两个事件：online和offline。当网络从离线变为在线或者从在线变为
离线时，分别触发这两个事件。这两件在window对象上触发。
EventUtil.addHandler(window, "online", function() {
	alert("Online");
});
EventUtil.addHandler(window, "offline", function() {
	alert("Offline");
});

23.2 应用缓存
HTML5的应用缓存，或者简称为appcache，是专门为开发离线Web应用而设计的。Appcache就是从浏览器的缓存中分出来的一块缓存区。要想在这个缓
存中保存数据，可以使用一个描述文件，列出要下载和缓存的资源。
要将描述文件与页面关联起来，可以在<html>中的manifest属性中指定这个文件的路径，例如：
<html manifest="/offline.manifest">
以上代码告诉页面，/offline.manifest中包含着描述文件。这个文件的MIME类型必须是text/cache-manifest。
虽然应用缓存的意图是确保离线时资源可用，但也有相应的JavaScript API让你知道它都在做什么。这个API的核心是applicationCache对象，这个
对象有一个status属性，属性的值是常量，表示应用缓存的如下当前状态。
・0：无缓存，即没有与页面相关的应用缓存
・1：闲置，即应用缓存未得到更新
・2：检查中，即正在下载描述文件并检查更新
・3：下载中，即应用缓存正在下载描述文件中指定的资源
・4：更新完成，即应用缓存已经更新了资源，而且所有资源都已下载完毕，可以通过swapCache()来使用了。
・5：废弃，即应用缓存的描述文件已经不存在了，因为页面无法再访问应用缓存
应用缓存还有很多相关的事件，表示其状态的改变。以下是这些事件：
・checking：在浏览器为应用缓存查找更新时触发
・error：在检查更新或下载资源期间发生错误时触发
・noupdate：在检查描述文件发现文件无变化时书法
・downloading：在开始下载应用缓存资源时触发
・progress：在文件下载应用缓存的过程中持续不断地触发
・updateready：在页面新的应用缓存下载完毕且可以通过swapCache()使用时触发
・cached：在应用缓存完整可用时触发

23.3 数据存储
随着Web应用程序的出现，也产生了对于能够直接在客户端上存储用户信息能力的要求。

23.3.1 Cookie
HTTP Cookie，通常直接叫做cookie，最初是在客户端用于存储会话信息的。该标准要求服务器对任意HTTP请求发送Set-Cookie HTTP头作为响应的
一部分，其中包含会话信息。
浏览器会存储这样的会话信息，并在这之后，通过为每个请求添加Cookie HTTP头讲信息发送回服务器。
发送回服务器的额外信息可以用于唯一验证客户来自于发送的哪个请求。

1.限制
cookie在性质上是绑定在特定的域名下的。每个域的cookie总数是有限的，各浏览器之间各不相同。
・IE6以及更低版本限制每个域名最多20个cookie
・IE7之后的版本限制为50个
・FireFox为50个
・Opera为30个
・Safari和Chrome没有硬性限制

2.cookie的构成
cookie由浏览器保存的以下几块信息构成。
・名称：一个唯一确定cookie的名称。cookie名称是不区分大小写的。cookie的名称必须是经过URL编码的
・值：储存在cookie中的字符串值。值必须被URL编码
・域：cookie对于哪个域是有效的。所有向该域发送的请求中都会包含这个cookie信息
・路径：对于指定域中的那个路径，应该向服务器发送cookie。
・失效时间：表示cookie何时应该被删除的时间戳。默认情况下，浏览器会话结束时即将所有cookie删除；不过也可以自己设置删除时间。
・安全标志：指定后，cookie只有在使用SSL连接的时候才发送到服务器。、

3. JavaScript中的cookie





